<?xml version="1.0" encoding="UTF-8" ?>

<!--
	* (c) 2008 Varsity Gateway LLC.
	* All rights reserved.
	*
	* This descriptor is used for deploying JBEDSP to JON for enterprise use
	* -->

<plugin name="MetaMatrixPlugin" displayName="MetaMatrix Plugin"
	package="com.metamatrix.rhq.plugin" version="2.0.0"	
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns="urn:xmlns:rhq-plugin" xmlns:c="urn:xmlns:rhq-configuration">

	<server name="MetaMatrix System"
		discovery="MetaMatrixSystemDiscoveryComponent"
		class="MetaMatrixSystemComponent" description="MetaMatrix System"
		singleton="true">

		<operation name="bounceSystem"
			displayName="Bounce MetaMatrix System"
			description="Stop and restart the MetaMatrix system">
			<parameters>
				<c:simple-property name="waitUntilFinished"
					type="boolean" default="false"
					description="If true, this method waits until the operation is finished before returning. This may take a long time to complete.  If false, this method returns immediately, even though the operation may not be finished." />
			</parameters>
		</operation>

		<operation name="listUsers"
			displayName="View current user sessions"
			description="List current user sessions connected to this MetaMatrix System">
			<results>
				<c:list-property name="list">
					<c:map-property name="map">
						<c:simple-property displayName="User Name"
							name="getUserName" type="string"
							description="The username for the user of this session" />
						<c:simple-property
							displayName="Application Name" name="getApplicationName"
							type="string"
							description="The name of the application this user is accessing MetaMatrix through" />
						<c:simple-property displayName="Session ID"
							name="getSessionID" type="string"
							description="The id for this session" />
						<c:simple-property displayName="VDB Name"
							name="getVDBName" type="string"
							description="The name of the VDB the user is connected to" />
						<c:simple-property displayName="VDB Version"
							name="getVDBVersion" type="string"
							description="The version of the VDB the user is connected to" />
						<c:simple-property displayName="Product Name"
							name="getProductName" type="string"
							description="The product name" />
						<c:simple-property displayName="IP Address"
							name="getIPAddress" type="string"
							description="The IP Address for this user's connection" />
						<c:simple-property displayName="Host Name"
							name="getHostName" type="string"
							description="The host name for this user's connection" />
						<c:simple-property displayName="Last Ping Time"
							name="getLastPingTime" type="string"
							description="The last time this client was ping'd" />
						<c:simple-property displayName="State"
							name="getStateAsString" type="string"
							description="The current state of this session" />
					</c:map-property>
				</c:list-property>
			</results>
		</operation>

		<operation name="listQueries" displayName="View current queries"
			description="List current queries executing against the MetaMatrix System">
			<parameters>
				<c:simple-property name="includeSourceQueries"
					type="boolean" default="true"
					description="If true, source queries will be included in the results.  If false, only top-level MetaMatrix queries will be included in the results." />
			</parameters>
			<results>
				<c:list-property name="list">
					<c:map-property name="map">
						<c:simple-property displayName="User Name"
							name="getUserName" type="string"
							description="The username for the user that submitted this query" />
						<c:simple-property displayName="Session ID"
							name="getSessionID" type="string"
							description="The id for the session" />
						<c:simple-property displayName="Request ID"
							name="getRequestID" type="string"
							description="The id for the request" />
						<c:simple-property displayName="Start Time"
							name="getCreated" type="string"
							description="The time this query has been running" />
						<c:simple-property displayName="Transaction ID"
							name="getTransactionID" type="string"
							description="The version of the VDB the user is connected to" />
						<c:simple-property displayName="SQL String"
							name="getSqlCommand" type="string"
							description="The SQL string for this query" />
						<c:simple-property
							displayName="Connector Binding Name"
							name="getConnectorBindingName" type="string"
							description="The IP Address for this user's connection" />
						<c:simple-property displayName="Node ID"
							name="getNodeID" type="string"
							description="The node ID of this query" />
						<c:simple-property displayName="Source Request"
							name="isSource" type="string"
							description="If false this is the top level query. If true this a physical source query." />
					</c:map-property>
				</c:list-property>
			</results>
		</operation>

		<operation name="listLongRunningQueries"
			displayName="View current long running queries"
			description="List current queries executing against the MetaMatrix System that have surpassed the long running query threshhold">
			<parameters>
				<c:simple-property name="includeSourceQueries"
					type="boolean" default="true"
					description="If true, source queries will be included in the results.  If false, only top-level MetaMatrix queries will be included in the results." />
			</parameters>
			<results>
				<c:list-property name="list">
					<c:map-property name="map">
						<c:simple-property displayName="User Name"
							name="getUserName" type="string"
							description="The username for the user that submitted this query" />
						<c:simple-property displayName="Session ID"
							name="getSessionID" type="string"
							description="The name of the resource whose availability is being reported" />
						<c:simple-property displayName="Request ID"
							name="getRequestID" type="string"
							description="The id for the request" />
						<c:simple-property displayName="Start Time"
							name="getCreated" type="string"
							description="The time this query has been running" />
						<c:simple-property displayName="Transaction ID"
							name="getTransactionID" type="string"
							description="The version of the VDB the user is connected to" />
						<c:simple-property displayName="SQL String"
							name="getSqlCommand" type="string"
							description="The SQL string for this query" />
						<c:simple-property
							displayName="Connector Binding Name"
							name="getConnectorBindingName" type="string"
							description="The IP Address for this user's connection" />
						<c:simple-property displayName="Node ID"
							name="getNodeID" type="string"
							description="The node ID of this query" />
						<c:simple-property displayName="Source Request"
							name="isSource" type="string"
							description="If false this is the top level query. If true this a physical source query." />
					</c:map-property>
				</c:list-property>
			</results>
		</operation>

		<operation name="killRequest" displayName="Terminate query"
			description="Terminate the processing of a query and it's source queries">
			<parameters>
				<c:simple-property displayName="SessionID|RequestID"
					name="requestID" type="string" required="true"
					description="The IDs of the session|request to terminate (use format = sessionID|requestID)" />
			</parameters>
		</operation>

		<operation name="listVDBs" displayName="View VDBs"
			description="List VDBs in this MetaMatrix System">
			<results>
				<c:list-property name="list">
					<c:map-property name="map">
						<c:simple-property displayName="Name"
							name="getName" type="string" description="The name of this VDB" />
						<c:simple-property displayName="Version"
							name="getVDBVersion" type="string"
							description="The version of this VDB" />
						<c:simple-property displayName="State"
							name="getStateAsString" type="string"
							description="The state of this VDB" />
						<c:simple-property displayName="Has WSDL"
							name="hasWSDL" type="string"
							description="If true, this VDB contains a WSDL file" />
						<c:simple-property
							displayName="Has Materialized Views" name="hasMaterializedViews"
							type="string"
							description="If true, this VDB contains one or more materialized views" />
						<c:simple-property displayName="Created Date"
							name="getCreatedDate" type="string"
							description="The creation date of this VDB" />
						<c:simple-property displayName="Created By"
							name="getCreatedBy" type="string"
							description="The user that created this VDB" />
						<c:simple-property displayName="Versioned Date"
							name="getVersionedDate" type="string"
							description="The version date of this VDB" />
						<c:simple-property displayName="Versioned By"
							name="getVersionedBy" type="string"
							description="The user that versioned this VDB" />
					</c:map-property>
				</c:list-property>
			</results>
		</operation>

		<operation name="getProperties"
			displayName="View system properties"
			description="List the system properties of this MetaMatrix System">
			<results>
				<c:list-property name="list">
					<c:map-property name="map">
						<c:simple-property name="Name" type="string"
							description="The name of this property" />
						<c:simple-property name="Value" type="string"
							description="The value of this property" />
					</c:map-property>
				</c:list-property>
			</results>
		</operation>

		<operation name="getHostProperties"
			displayName="View host properties"
			description="List the host properties of this MetaMatrix System">
			<results>
				<c:list-property name="list">
					<c:map-property name="map">
						<c:simple-property name="Name" type="string"
							description="The name of this property" />
						<c:simple-property name="Value" type="string"
							description="The value of this property" />
					</c:map-property>
				</c:list-property>
			</results>
		</operation>

		<metric displayName="Query Count" defaultOn="true"
			displayType="summary" category="throughput" property="queryCount"
			description="The number of queries for a given point in time" />

		<metric displayName="Long Running Queries" defaultOn="true"
			displayType="summary" category="performance"
			property="longRunningQueries"
			description="The number of queries that have been running longer than the limit set for queries. The default is 60 minutes, but this may be overridden by the 'longRunningQueryTime' system variable." />

		<metric displayName="Session Count" defaultOn="true"
			displayType="summary" category="throughput" property="sessionCount"
			description="The number of user connections for a given point in time" />
			
			<resource-configuration>
                 <c:group name="general" displayName="General" hiddenByDefault="false">
                    <c:description>Query Configuration</c:description>
                    <c:simple-property name="longrunning.query.limit" type="string" readOnly="true" required="true" displayName="Long Running Query limit" description="The value (in seconds) to use to determine if a query is to be considered 'long running'.">
                    </c:simple-property>
                 </c:group>
             </resource-configuration>

		<server name="MetaMatrix Process"
			discovery="MetaMatrixServerDiscoveryComponent"
			class="MetaMatrixServerComponent"
			description="MetaMatrix Server instance">
			
	        <plugin-configuration>
		         <c:group name="event" displayName="Process Log Tracking">
                     <c:simple-property name="enabled" type="boolean" summary="true" default="true" required="true"
                                        description="A flag indicating whether of not this log Event source is currently
                                                     enabled (i.e. whether the associated log file should be tailed for
                                                     new entries)."/>
                     <c:simple-property name="minimumSeverity" required="true" default="ERROR" 
                                        description="The minimum severity of Events that should be collected for this
                                                     source. The default is ERROR.">
                         <c:property-options>
                            <c:option name="DEBUG" value="DEBUG"/>
                            <c:option name="INFO"  value="INFO"/>
                            <c:option name="WARNING"  value="WARNING"/>
                            <c:option name="ERROR" value="ERROR" default="true"/>
                         </c:property-options>
                     </c:simple-property>
		         </c:group>	        
	        </plugin-configuration>			
	        
            <operation name="getProperties"
				displayName="View process properties"
				description="List the process properties of this vm instance">
				<results>
					<c:list-property name="list">
						<c:map-property name="map">
							<c:simple-property name="Name" type="string"
								description="The name of this property" />
							<c:simple-property name="Value"
								type="string" description="The value of this property" />
						</c:map-property>
					</c:list-property>
				</results>
			</operation>

			<metric displayName="Query High Water Mark" defaultOn="true"
				displayType="summary" category="utilization"
				property="highWatermark"
				description="High water mark for queries in the Socket Worker Queue" />

 			<event name="errorLogEntry" description="an entry in a log file"/>  
			<!-- Ted Jones - 06/19/08
				Commenting out current threads metric until http://jira.jboss.org/jira/browse/JBEDSP-426 is resolved. -->
			<!--     <metric displayName="Current Threads"
				defaultOn="true"
				displayType="summary"
				category="utilization"
				property="threadCount"
				description="The number of active threads in the Socket Worker Queue"/> -->

			<service name="Connectors"
				discovery="MetaMatrixConnectorDiscoveryComponent"
				class="MetaMatrixConnectorComponent">
				<operation name="getProperties"
					displayName="View connector properties"
					description="List the properties of this connector">
					<results>
						<c:list-property name="list">
							<c:map-property name="map">
								<c:simple-property name="Name"
									type="string" description="The name of this property" />
								<c:simple-property name="Value"
									type="string" description="The value of this property" />
							</c:map-property>
						</c:list-property>
					</results>
				</operation>
				<operation name="restartConnector"
					displayName="Re-start Connector"
					description="Start/re-start this connector binding" />
				<operation name="stopConnector"
					displayName="Stop Connector"
					description="Stop this connector binding">
					<parameters>
						<c:simple-property name="stopNow" type="boolean"
							default="true"
							description="If true, stop the process forcefully. If false, wait until any pending work is completed." />
					</parameters>
				</operation>
			</service>

		</server>
		<server name="Host Controller"
			discovery="MetaMatrixHostControllerDiscoveryComponent"
			class="MetaMatrixHostControllerComponent"
			description="MetaMatrix Host Controller">
		</server>
	</server>
</plugin>