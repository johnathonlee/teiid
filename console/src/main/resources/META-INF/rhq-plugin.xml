<?xml version="1.0" encoding="UTF-8" ?>

	<!--
		* JBoss, Home of Professional Open Source. * See the COPYRIGHT.txt
		file distributed with this work for information * regarding copyright
		ownership. Some portions may be licensed * to Red Hat, Inc. under one
		or more contributor license agreements. * * This library is free of
		the GNU Lesser General Public * License as published by the Free
		Software Foundation; either * version 2.1 of the License, or (at your
		option) any later version. * * This library is distributed in the hope
		that it will be useful, * but WITHOUT ANY WARRANTY; without even the
		implied warranty of * MERCHANTABILITY or FITNESS FOR A PARTICULAR
		PURPOSE. See the GNU * Lesser General Public License for more details.
		* * You should have received a copy of the GNU Lesser General Public *
		License along with this library; if not, write to the Free Software *
		Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA *
		02110-1301 USA. */
	-->
	
	<!DOCTYPE plugin [

<!ENTITY managedObjectMetrics '
    <metric property="runState" displayType="summary"
            defaultOn="true" defaultInterval="30000" dataType="trait" category="performance"/>
'>

<!ENTITY translatorConfiguration '

    <c:list-property name="translatorList" description="Properties for this translator"
						readOnly="true">
						<c:simple-property name="name" displayName="Name"
							description="Name of the translator" />
						<c:simple-property name="execution-factory-class" displayName="execution-factory-class"
							description="Connector Class" />	
						 <c:list-property name="translatorList" description="Properties for this translator" readOnly="true">
						<c:map-property name="translator-properties" >
							<c:simple-property name="name" displayName="Name"
								description="Name of this property" readOnly="true" />
							<c:simple-property name="value" displayName="Value"
								description="Value of this property" />
							<c:simple-property name="description" displayName="Description"
								description="Description of this property" />
						</c:map-property>						
	</c:list-property>
	
'>			
		
<!ENTITY accessTranslatorConfiguration '
	<resource-configuration>
    <c:list-property name="translatorList" description="Properties for this translator"
						readOnly="true">
						<c:map-property name="translatorMap">
							<c:simple-property name="name" displayName="Name"
								description="Name of this property" readOnly="true" />
							<c:simple-property name="value" displayName="Value"
								description="Value of this property" readOnly="true" />
							<c:simple-property name="description" displayName="Description"
								description="Description of this property" readOnly="true" />
						</c:map-property>
	</c:list-property>
	</resource-configuration>    
    
'>					


]>

	<!--
		############################################# END OF XML ENTITIES
		###############################################
	-->



<plugin name="TeiidPlugin" displayName="Teiid Plugin" package="org.teiid.rhq.plugin"
	version="2.0.0" description="Supports management and monitoring of JBoss Teiid"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="urn:xmlns:rhq-plugin"
	xmlns:c="urn:xmlns:rhq-configuration">

	<depends plugin="JMX" />
	<depends plugin="JBossAS5" useClasses="true" />

	<server name="Data Services" description="Teiid Data Services"
		class="PlatformComponent" discovery="PlatformDiscoveryComponent"
		singleton="true">

		<runs-inside>
			<parent-resource-type name="JBossAS Server"
				plugin="JBossAS5" />
		</runs-inside>

		<operation name="getLongRunningRequests" displayName="View current long running queries"
			description="List current queries executing against the Teiid System that have surpassed the long running query threshhold">
			<results>
				<c:list-property name="list">
					<c:map-property name="map">
						<c:simple-property displayName="Session ID"
							name="getSessionId" type="string"
							description="The name of the resource whose availability is being reported" />
						<c:simple-property displayName="Request ID"
							name="getRequestId" type="string" description="The id for the request" />
						<c:simple-property displayName="SQL String"
							name="getCommand" type="string" description="The SQL string for this query" />
						<c:simple-property displayName="Source Request"
							name="sourceRequest" type="string"
							description="If false,this is the top level query. If true, this a physical source query." />
						<c:simple-property displayName="Execution ID"
							name="getExecutionId" type="string"
							description="The execution id for this request (if this is a physical source query)" />
						<c:simple-property displayName="Start Time"
							name="getCreatedTime" type="string" description="The time this query began" />
						<c:simple-property displayName="Start Time"
							name="getProcessingTime" type="string" description="Processing time for this request" />
						<c:simple-property displayName="Transaction ID"
							name="getTransactionId" type="string"
							description="The transaction XID if there is a transaction involved" />
						<c:simple-property displayName="Node ID" name="getNodeId"
							type="string" description="The node ID of this query" />
					</c:map-property>
				</c:list-property>
			</results>
		</operation>

		<operation name="getSessions" displayName="View current sessions"
			description="Get current sessions connected to the Teiid instance">
			<results>

				<c:list-property name="list" displayName="Current Sessions"
					description="Sessions currently connected to the Teiid system"
					required="false">
					<c:map-property name="map">
						<c:simple-property displayName="Session ID"
							name="getSessionId" type="string" description="The identifier for this session" />
						<c:simple-property displayName="Application Name"
							name="getApplicationName" type="string"
							description="The application associated with Session" />
						<c:simple-property displayName="Created Time"
							name="getCreatedTime" type="string" description="When the session was created" />
						<c:simple-property displayName="Client Host"
							name="getClientHostName" type="string"
							description="Host name from where the session created" />
						<c:simple-property displayName="IP Address"
							name="getIPAddress" type="string"
							description="IP address from where this session was created" />
						<c:simple-property displayName="Last ping time"
							name="getLastPingTime" type="string" description="Last ping time" />
						<c:simple-property displayName="User Name" name="getUserName"
							type="string" description="User associated with this session" />
						<c:simple-property displayName="VDB Name" name="getVDBName"
							type="string" description="VDB associated with this session" />
						<c:simple-property displayName="Security Domain"
							name="getSecurityDomain" type="string"
							description="Security Domain that session logged into" />
					</c:map-property>
				</c:list-property>
			</results>
		</operation>

		<operation name="terminateSession" displayName="Terminate Session"
			description="Terminate a specified session">
			<parameters>
				<c:simple-property displayName="SessionID" name="sessionID"
					type="long" required="true" description="The ID of the session to terminate" />
			</parameters>
		</operation>


		<operation name="getRequests" displayName="View current requests"
			description="Get current requests executing against this Teiid instance">
			<results>

				<c:list-property name="list" displayName="Current Request"
					description="Requests currently executing against the Teiid system"
					required="false">
					<c:map-property name="map">
						<c:simple-property displayName="Request ID"
							name="getRequestId" type="string" description="The request identifier" />
						<c:simple-property displayName="Session ID"
							name="getSessionId" type="string" description="Session identifier" />
						<c:simple-property displayName="Execution ID"
							name="getExecutionId" type="string" description="Unique Identifier for Request" />
						<c:simple-property displayName="Created Time"
							name="getCreatedTime" type="string" description="Time when request submitted" />
						<c:simple-property displayName="Processing Time"
							name="getProcessingTime" type="string" description="Processing time for the request" />
						<c:simple-property displayName="Last ping time"
							name="getCommand" type="string" description="SQL Command" />
						<c:simple-property displayName="Connector level request?"
							name="sourceRequest" type="string"
							description="True if this is a connector level request" />
						<c:simple-property displayName="Node ID" name="getNodeId"
							type="string" description="The node identifier" />
						<c:simple-property displayName="Tansaction identifier"
							name="getTransactionId" type="string"
							description="Transaction XID if a transaction is involved" />
					</c:map-property>
				</c:list-property>
			</results>
		</operation>

		<operation name="cancelRequest" displayName="Terminate request"
			description="Terminate the processing of a query and its source queries">
			<parameters>
				<c:simple-property displayName="Session ID" name="sessionID"
					type="long" required="true"
					description="The ID of the session that the request to cancel is associated with" />
				<c:simple-property displayName="Request ID" name="requestID"
					type="long" required="true" description="The ID of the request to cancel" />
			</parameters>
		</operation>

		<operation name="getTransactions" displayName="View current transactions"
			description="Get current transactions executing against this VDB">
			<results>
				<c:list-property name="list" displayName="Current Transactions"
					description="Transactions currently executing against the Teiid system"
					required="false">
					<c:map-property name="map">
						<c:simple-property displayName="Transaction ID"
							name="getId" type="string"
							description="The Xid string for GLOBAL transactions or the Transaction id string LOCAL/REQUEST." />
						<c:simple-property displayName="Session ID"
							name="getAssociatedSession" type="string"
							description="Get the session associated with the this transaction. May be null for an unassociated Global transaction." />
						<c:simple-property displayName="Scope" name="getScope"
							type="string"
							description="Get the scope for the transaction.  Will be one of GLOBAL, LOCAL, or REQUEST" />
						<c:simple-property displayName="Created Time"
							name="getCreatedTime" type="string" description="The local creation time." />
					</c:map-property>
				</c:list-property>
			</results>
		</operation>

		<operation name="terminateTransaction" displayName="Terminate Transaction"
			description="Terminate a specified transaction">
			<parameters>
				<c:simple-property displayName="Transaction ID"
					name="transactionID" type="long" required="true"
					description="The ID of the transaction to terminate" />
			</parameters>
		</operation>

		<metric displayName="Query Count" defaultOn="true" displayType="detail"
			category="throughput" property="queryCount"
			description="The number of queries for a given point in time" />

		<metric displayName="Long Running Queries" defaultOn="true"
			displayType="detail" category="performance" property="longRunningQueries"
			description="The number of queries that have been running longer than the limit set for queries." />

		<metric displayName="Session Count" defaultOn="true"
			displayType="detail" category="throughput" property="sessionCount"
			description="The number of user connections for a given point in time" />

		<resource-configuration>
			<c:group name="teiidProperties" displayName="Runtime Engine Properties"
				hiddenByDefault="false">
				<c:simple-property name="resultSetCacheMaxEntries"
					displayName="Result Set Cache Max Entries"
					description="The maximum number of result set cache entries. 0 indicates no limit. (default 1024)"
					required="false" readOnly="false" />
				<c:simple-property name="maxRowsFetchSize"
					displayName="Max Rows Fetch Size"
					description="The maximum number of result set cache entries. 0 indicates no limit. (default 1024)"
					required="false" readOnly="false" />
				<c:simple-property name="codeTablesMaxRows"
					displayName="Code Tables Max Rows"
					description="Maximum number of records in all lookup tables (default 200000)"
					required="false" readOnly="false" />
				<c:simple-property name="processName" displayName="Process Name"
					description="Name that uniquely identifies this process" required="false"
					readOnly="false" />
				<c:simple-property name="preparedPlanCacheMaxCount"
					displayName="Prepared Plan Cache Max Count"
					description="The maximum number of query plans that are cached. Note: this is a memory based cache. (default 250)"
					required="false" readOnly="false" />
				<c:simple-property name="maxThreads" displayName="Max Threads"
					description="Process pool maximum thread count. (default 16) Increase this value if your load includes a large number of XQueries or if the system's available processors is larger than 8"
					required="false" readOnly="false" />
				<c:simple-property name="timeSliceInMilli"
					displayName="Time Slice In Milliseconds"
					description="Query processor time slice, in milliseconds. (default 2000)"
					required="false" readOnly="false" />
				<c:simple-property name="processDebugAllowed"
					displayName="Process Debug Allowed" description="True if process debug allowed"
					required="false" readOnly="false" />
				<c:simple-property name="lobChunkSizeInKB"
					displayName="Lob Chunk Size In KB"
					description="The max lob chunk size in KB transferred each time when processing blobs, clobs(100KB default)"
					required="false" readOnly="false" />
				<c:simple-property name="codeTablesMaxCount"
					displayName="Code Tables Max Count"
					description="The max lob chunk size in KB transferred each time when processing blobs, clobs(100KB default)"
					required="false" readOnly="false" />
				<c:simple-property name="resultSetCacheEnabled"
					displayName="Result Set Cache Enabled"
					description="Denotes whether or not result set caching is enabled. (default true)"
					required="false" readOnly="false" type="boolean" />
				<c:simple-property name="codeTablesMaxRowsPerTable"
					displayName="Code Tables Max Rows Per Table"
					description="Maximum number of records in all lookup tables (default 200000)"
					required="false" readOnly="false" />
				<c:simple-property name="activeSessionsCount"
					displayName="Active Session Count" description="Count of active sessions"
					required="false" readOnly="false" />
				<c:simple-property name="queryThresholdInSecs"
					displayName="Long Running Query Threshold" description="Length of time in seconds before a query is considered long running"
					required="false" readOnly="false" />	
			</c:group>
			<c:group name="bufferServiceProperties" displayName="Buffer Service Properties"
				hiddenByDefault="false">
				<c:simple-property name="processorBatchSize"
					displayName="Processor Batch Size"
					description="The max row count of a batch sent internally within the query processor. Should be &lt;= the connectorBatchSize. (default 256)"
					required="false" readOnly="false" />
				<c:simple-property name="connectorBatchSize"
					displayName="Connector Batch Size"
					description="The max row count of a batch from a connector. Should be even multiple of processorBatchSize. (default 512)"
					required="false" readOnly="false" />
				<c:simple-property name="maxProcessingBatchesColumns"
					displayName="Max Processing Batches Columns"
					description="The number of batch columns guarenteed to a processing operation.  Set this value lower if the workload typically processes larger numbers of concurrent queries with large intermediate results from operations such as sorting, grouping, etc. (default 128)"
					required="false" readOnly="false" />
				<c:simple-property name="maxFileSize" displayName="Max File Size"
					description="Max file size for buffer files (default 2GB)"
					required="false" readOnly="false" />
				<c:simple-property name="maxReserveBatchColumns"
					displayName="Max Reserve Batch Columns"
					description="The number of batch columns to allow in memory (default 16384).  This value should be set lower or higher depending on the available memory to Teiid in the VM.  16384 is considered a good default for a dedicated 32-bit VM running Teiid with a 1 gig heap."
					required="false" readOnly="false" />
			</c:group>
			<c:group name="jdbcSocketConfigurationProperties"
				displayName="Jdbc Socket Configuration Properties" hiddenByDefault="false">
				<c:simple-property name="portNumber" displayName="Port Number"
					description="Port Number" required="false" readOnly="false" />
				<c:simple-property name="enabled" displayName=" SSL Enabled"
					description="SSL enabled" required="false" readOnly="false" type="boolean"
					default="true" />
				<c:simple-property name="hostName" displayName="Host Name"
					description="Host Name" required="false" readOnly="false" />
				<c:simple-property name="maxSocketThreads"
					displayName="Max Socket Threads" description="Max NIO threads"
					required="false" readOnly="false" />
				<c:simple-property name="inputBufferSize"
					displayName="Input Buffer Size"
					description="SO_RCVBUF size, 0 indicates that system default should be used (default 0)"
					required="false" readOnly="false" />
				<c:simple-property name="outputBufferSize"
					displayName="Output Buffer Size"
					description="SO_SNDBUF size, 0 indicates that system default should be used (default 0)"
					required="false" readOnly="false" />
			</c:group>
			<c:group name="sessionServiceProperties" displayName="Session Service Properties"
				hiddenByDefault="false">
				<c:simple-property name="sessionExpirationTimeLimit"
					displayName="Session Expiration Time Limit"
					description="Max allowed time before the session is terminated by the system, 0 indicates unlimited (default 0)"
					required="false" readOnly="false" />
				<c:simple-property name="sessionMaxLimit"
					displayName="Session Max Limit"
					description="Maximum number of sessions allowed by the system (default 5000)"
					required="false" readOnly="false" />
			</c:group>
		</resource-configuration>

		<service name="Virtual Database (VDB)s" description="Teiid Data Services Virtual Databases"
			class="VDBComponent" discovery="VDBDiscoveryComponent"
			createDeletePolicy="both" creationDataType="content">

			<operation name="getSessions" displayName="View VDB Sessions"
				description="Get current sessions currently connected to this VDB">
				<results>

					<c:list-property name="list" displayName="Current VDB Sessions"
						description="Sessions currently connected to this VDB" required="false">
						<c:map-property name="map">
							<c:simple-property displayName="Session ID"
								name="getSessionId" type="string" description="The identifier for this session" />
							<c:simple-property displayName="Application Name"
								name="getApplicationName" type="string"
								description="The application associated with Session" />
							<c:simple-property displayName="Created Time"
								name="getCreatedTime" type="string" description="When the session was created" />
							<c:simple-property displayName="Client Host"
								name="getClientHostName" type="string"
								description="Host name from where the session created" />
							<c:simple-property displayName="IP Address"
								name="getIPAddress" type="string"
								description="IP address from where this session was created" />
							<c:simple-property displayName="Last ping time"
								name="getLastPingTime" type="string" description="Last ping time" />
							<c:simple-property displayName="User Name"
								name="getUserName" type="string" description="User associated with this session" />
							<c:simple-property displayName="Security Domain"
								name="getSecurityDomain" type="string"
								description="Security Domain that session logged into" />
						</c:map-property>
					</c:list-property>
				</results>
			</operation>

			<operation name="getRequests" displayName="View VDB requests"
				description="Get current requests executing against this VDB">
				<results>

					<c:list-property name="list" displayName="Current Request"
						description="Requests currently executing against the Teiid system"
						required="false">
						<c:map-property name="map">
							<c:simple-property displayName="Request ID"
								name="getRequestId" type="string" description="The request identifier" />
							<c:simple-property displayName="Session ID"
								name="getSessionId" type="string" description="Session identifier" />
							<c:simple-property displayName="Execution ID"
								name="getExecutionId" type="string" description="Unique Identifier for Request" />
							<c:simple-property displayName="Created Time"
								name="getCreatedTime" type="string" description="Time when request submitted" />
							<c:simple-property displayName="Processing Time"
								name="getProcessingTime" type="string" description="Processing time for the request" />
							<c:simple-property displayName="Last ping time"
								name="getCommand" type="string" description="SQL Command" />
							<c:simple-property displayName="Connector level request?"
								name="sourceRequest" type="string"
								description="True if this is a connector level request" />
							<c:simple-property displayName="Node ID" name="getNodeId"
								type="string" description="The node identifier" />
							<c:simple-property displayName="Tansaction identifier"
								name="getTransactionId" type="string"
								description="Transaction XID if a transaction is involved" />
						</c:map-property>
					</c:list-property>
				</results>
			</operation>

			<metric displayName="Status" defaultOn="true" dataType="trait"
				displayType="summary" category="availability" property="status"
				description="The status of this VDB" />

			<metric displayName="Errors" defaultOn="true" dataType="trait"
				displayType="summary" category="availability" property="errorCount"
				description="Whether or not errors exist for this VDB" />

			<content name="vdb" displayName="VDB Archive" category="deployable"
				isCreationType="true">
			</content>

			<resource-configuration>
				<c:group name="general" displayName="General"
					hiddenByDefault="false">
					<c:simple-property name="name" type="string"
						description="The Virtual Database Name" required="false" readOnly="true" />
					<c:simple-property name="version" type="string"
						description="The Virtual Database Version" required="false"
						readOnly="true" />
					<c:simple-property name="description" type="string"
						description="The Virtual Database Description" required="false"
						readOnly="true" />
					<c:simple-property name="status" type="string"
						description="The Virtual Database Status" required="false"
						summary="true">
						<c:property-options>
							<c:option value="ACTIVE" name="UP" />
							<c:option value="INACTIVE" name="DOWN" default="true" />
						</c:property-options>
					</c:simple-property>
					<c:simple-property name="url" type="string"
						description="The Virtual Database URL" required="false" readOnly="true" />
				</c:group>
				<c:group name="Models" displayName="Models" hiddenByDefault="false">
					<c:list-property name="singleSourceModels" readOnly="true"
						description="The source models for this VDB">
						<c:map-property name="map" description="Properties for this model">
							<c:simple-property name="name" displayName="Name"
								description="Name of the model" required="true" readOnly="true" />
							<c:simple-property name="sourceName"
								displayName="Source Name" description="Source name for this model"
								required="false" readOnly="true" />
							<c:simple-property name="translatorName"
								displayName="Translator Name" description="Name of the translator"
								required="false" readOnly="true"/>
							<c:simple-property name="jndiName" displayName="Connection JNDI Name"
								description="JNDI name for this connection" required="false" />
							<c:simple-property name="visibility"
								displayName="Visible" description="Visibility of the model"
								required="true" type="boolean" readOnly="true"> 
							</c:simple-property>
							<c:simple-property name="supportsMultiSource"
								displayName="Supports Multi-source?"
								description="Determines if this model supports multi-source bindings"
								required="true" default="true" type="boolean" readOnly="true"/>
						</c:map-property>
					</c:list-property>

					<c:list-property name="multiSourceModels"
						description="The multi-source model sources for this VDB">
						<c:map-property name="map" readOnly="false">
							<c:simple-property name="name" displayName="Name"
								description="Name of the model" required="true" readOnly="true" />
							<c:simple-property name="sourceName"
								displayName="Source Name" description="Source name for this model" readOnly="true"/>
							<c:simple-property name="translatorName"
								displayName="Translator Name" description="Name of the translator"
								required="true" />
							<c:simple-property name="jndiName" displayName="Connection JNDI Name"
								description="JNDI name for this connection" required="false" />
						</c:map-property>
					</c:list-property>

					<c:list-property name="logicalModels" readOnly="true"
						description="The logical models for this VDB">
						<c:map-property name="map">
							<c:simple-property name="name" displayName="Name"
								description="Name of the model" required="true" readOnly="true" />
							<c:simple-property name="type" displayName="Type"
								description="type of logical model" required="true" readOnly="true" />
							<c:simple-property name="visibility"
								displayName="Visible" description="Visbility of the model"
								required="true" default="true" readOnly="true"/>
						</c:map-property>
					</c:list-property>
				</c:group>
				<c:group name="errors" displayName="Errors" hiddenByDefault="false">
					<c:list-property name="errorList" description="VDB Errors"
						summary="true" readOnly="true">
						<c:map-property name="errorMap" summary="true">
							<c:simple-property name="severity" displayName="Severity"
								description="Severity" readOnly="true" summary="true" />
							<c:simple-property name="message" displayName="Message"
								description="Error message" readOnly="true" summary="true" />
						</c:map-property>
					</c:list-property>
				</c:group>
			</resource-configuration>

		</service>

		<service name="Translators" description="Teiid Translators"
			class="TranslatorComponent" discovery="TranslatorDiscoveryComponent"
			createDeletePolicy="both" creationDataType="configuration">

			<resource-configuration>
				<c:simple-property name="name" displayName="Name" description="Name of the translator" readOnly="true" required="false"/>
				<c:list-property name="translatorList" readOnly="true" required="false"
                			displayName="Properties" description="Translator properties">
					<c:map-property name="properties" readOnly="true">
						<c:simple-property name="name" displayName="Name" description="Name of this property" readOnly="true" />
						<c:simple-property name="value" displayName="Value"	description="Value of this property" readOnly="true"/>
					</c:map-property>
				</c:list-property>

			</resource-configuration>

		</service>

	</server>

</plugin>