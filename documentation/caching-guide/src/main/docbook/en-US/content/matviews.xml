<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
<!ENTITY % CustomDTD SYSTEM "../../../../../../docbook/custom.dtd">
%CustomDTD;
]>
<chapter id="matviews">
	<title>Materialized Views</title>
	<para>Teiid supports materialized views.  Materialized views are just like other views, but their 
		transformations are pre-computed and stored just like a regular table.  
		When queries are issued against the views through the Teiid Server, the cached results are used.
		 This saves the cost of accessing all the underlying data sources and
		re-computing the view transforms each time a query is
		executed.</para>
	<para>Materialized views are appropriate when the underlying data does not
		change rapidly, or when it is acceptable to retrieve data that is
		"stale" within some period of time, or when it is preferred for
		end-user queries to access staged data rather than placing additional
		query load on operational sources.</para>
	<section>
		<title>Support Summary</title>
		<itemizedlist>
			<listitem>
				<para>Caching of relational table or view records (pre-computing all
					transformations)</para>
			</listitem>
			<listitem>
				<para>Model-based definition of virtual groups to cache (requires Teiid Designer)</para>
			</listitem>
			<listitem>
				<para>User ability to override use of materialized view cache for
					specific queries through OPTION NO CACHE</para>
			</listitem>
		</itemizedlist>
	</section>
	<section>
		<title>User Interaction</title>
		<para>When client applications issue queries against a Relational
			table or view that has been defined as a materialized view, the
			Teiid query engine automatically routes that query to obtain the
			results from the cache database.</para>
		<para>Individual queries may override the use of materialized views by
			specifying OPTION NOCACHE on the query.  This parameter may specify
			one or more virtual groups to override (separated by commas, spaces
			optional).  If no virtual groups are specified, materialized views tables will not be used transitively. 
		</para>
		<example>
			<title>Full NOCACHE</title>
			<programlisting>SELECT * from vg1, vg2, vg3 WHERE … OPTION NOCACHE</programlisting>
		</example>
		<example>
			<title>Specific NOCACHE</title>
			<programlisting>SELECT * from vg1, vg2, vg3 WHERE … OPTION NOCACHE vg1, vg3</programlisting>
			<para>Only the vg1 and vg3 caches will be skipped vg2 or any materialized views nested under vg1 and vg3 will be used.</para>
		</example>
		<para>The materialization override option may be specified in virtual
			group transformation definitions.  In that way, transformations can
			specify to always use real-time data obtained directly from a source.
			 The use of caching and non-caching can be mixed in transformation
			definitions, just as with user queries.</para>
	</section>
	<section>
		<title>Materialized View Definition</title>
		<para>Materialized views are defined in Teiid Designer by
			setting the materialized property on a table or view in a virtual (view) relational
			model.  Setting this property's value to true (the default is false)
			allows the data generated for this virtual table to be treated as a
			materialized view. </para>
		<note><para>It is important to ensure that all key/index information is present as these will be used by the materialization process to enhance the performance of the materialized table.</para></note>
		<para>The target materialized table may also be set in the properties.  If the value is left blank, the default, then internal materialization will be used.  
		Otherwise for external materialization, the value should reference the fully qualified name of a table (or possibly view) with the same columns as the materialized view.
		The choice between internal and external materialization should be made based upon:
		<itemizedlist>
			<listitem><para>Does the cached data need to be fully persistent?  If yes, then external materialization should be used.  
			Internal materialization should not survive a cluster restart.</para>
			</listitem>
			<listitem><para>Is full control needed of loading and refresh?  If yes, then external materialzation should be used.  
			Internal materialization does offer several system supported methods for refreshing, but does not give full access to the materialized table.</para>
			</listitem>
		</itemizedlist>
		</para>
		
	</section>
	<section>
		<title>External Materialization</title>
		<para>External materialized views cache their data in an external database
			system.  External materialized views give the administrator full control over the loading and refresh strategies.</para>
		<para>Since the actual physical cache for materialized views is
			maintained external to the Teiid system, there is no pre-defined
			policy for clearing and managing the cache.  These policies will be
			defined and enforced by administrators of the Teiid system.
		</para>
		<para></para>
	</section>
</chapter>