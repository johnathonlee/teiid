<?xml version="1.0" encoding="UTF-8"?>

<deployment xmlns="urn:jboss:bean-deployer:2.0">

    <!-- Deployer specific Stuff -->
    <bean name="VDBStructure" class="org.teiid.deployers.VDBStructure" />
    
    <bean name="SystemFunctionManager" class="org.teiid.query.function.SystemFunctionManager">
        <property name="allowEnvFunction">false</property>
    </bean>  
        
    <bean name="VDBRepository" class="org.teiid.deployers.VDBRepository">
        <property name="systemFunctionManager"><inject bean="SystemFunctionManager"/></property>
        <!-- 
          Optionally set a org.teiid.metadata.MetadataRepository for persistent metadata updates
        -->
        <!-- <property name="metadataRepository"><inject bean="MetadataRepository"/></property> -->
    </bean>
    
    <bean name="SecurityHelper" class="org.teiid.jboss.JBossSecurityHelper"/>    
        
   <bean name="JBossLifeCycleListener" class="org.teiid.jboss.JBossLifeCycleListener"/>
        
    <bean name="VDBParserDeployer" class="org.teiid.deployers.VDBParserDeployer">
        <property name="vdbRepository"><inject bean="VDBRepository"/></property>
        <property name="objectSerializer"><inject bean="ObjectSerializer"/></property>
        <property name="managedObjectFactory"><inject bean="ManagedObjectFactory"/></property>
    </bean>
    
   <bean name="VDBMetaDataInstanceClassFactory" class="org.teiid.jboss.deployers.VDBMetaDataInstanceClassFactory">
      <constructor>
         <parameter><inject bean="ManagedObjectFactory"/></parameter>
      </constructor>
   </bean>
       
    <bean name="DynamicVDBDeployer" class="org.teiid.deployers.DynamicVDBDeployer">
    </bean>
    
    
    <bean name="ObjectSerializer" class="org.teiid.deployers.ObjectSerializer">
        <property name="attachmentStoreRoot">${jboss.server.data.dir}/teiid</property>
    </bean>
    
    <bean name="VDBDeployer" class="org.teiid.deployers.VDBDeployer">
        <install bean="ManagedDeploymentCreator" method="addAttachmentType">
            <parameter>
                <value>org.teiid.adminapi.impl.VDBMetaData</value>
            </parameter>
            <parameter>
                <value>teiid-vdb</value>
            </parameter>
        </install>
        <uninstall bean="ManagedDeploymentCreator" method="removeAttachmentType">
            <parameter>
                <value>org.teiid.adminapi.impl.VDBMetaData</value>
            </parameter>
        </uninstall>
        <property name="VDBRepository"><inject bean="VDBRepository"/></property>
        <property name="objectSerializer"><inject bean="ObjectSerializer"/></property>
        <property name="translatorRepository"><inject bean="translatorRepository"/></property>      
        <property name="containerLifeCycleListener"><inject bean="JBossLifeCycleListener"/></property>
        <property name="threadPool"><inject bean="jboss.system:service=ThreadPool"/></property>
        <depends>SystemVDBDeployer</depends>
    </bean>       
    
    <bean name="SystemVDBDeployer" class="org.teiid.deployers.SystemVDBDeployer">
        <property name="VDBRepository"><inject bean="VDBRepository"/></property>
    </bean>      
             
    <bean name="ConnectionFactoryDeployer" class="org.teiid.jboss.deployers.ConnectionFactoryDeployer">
        <property name="VDBStatusChecker"><inject bean="VDBStatusChecker"/></property>
    </bean>
        
    <bean name="translatorRepository" class="org.teiid.dqp.internal.datamgr.TranslatorRepository"/>   
     
    <bean name="TranslatorParserDeployer" class="org.teiid.deployers.TranslatorParserDeployer"/>
    <bean name="TranslatorDeployer" class="org.teiid.deployers.TranslatorDeployer">
        <property name="translatorRepository"><inject bean="translatorRepository"/></property>
        <property name="VDBStatusChecker"><inject bean="VDBStatusChecker"/></property>
    </bean>
    
    <bean name="TranslatorAnnotationScanner" class="org.teiid.deployers.TranslatorAnnotationScanningDeployer">
        <property name="translatorRepository"><inject bean="translatorRepository"/></property>
        <property name="VDBStatusChecker"><inject bean="VDBStatusChecker"/></property>
        <property name="managedObjectFactory"><inject bean="ManagedObjectFactory"/></property>
    </bean>
            
    <bean name="VDBStatusChecker" class="org.teiid.deployers.VDBStatusChecker">
        <property name="VDBRepository"><inject bean="VDBRepository"/></property>
        <property name="threadPool"><inject bean="jboss.system:service=ThreadPool"/></property>
    </bean>
     
    <!-- Persistence class for the VDB deployment file -->
   <bean name="VDBMetadataComponentMapper" class="org.teiid.jboss.deployers.VDBMetadataComponentMapper">
        <constructor><parameter><inject bean="PersistenceFactory" /></parameter></constructor>
   </bean>    
   <!-- Persistence class for the Translator deployment file -->
   <bean name="TranslatorMetadataGroupComponentMapper" class="org.teiid.jboss.deployers.TranslatorMetadataGroupComponentMapper">
        <constructor><parameter><inject bean="PersistenceFactory" /></parameter></constructor>
   </bean>   
   
   <bean name="TranslatorMetadataICF" class="org.teiid.templates.TranslatorMetadataICF">
      <constructor>
         <parameter><inject bean="ManagedObjectFactory"/></parameter>
      </constructor>
   </bean>   
        
    <!--  used for the translators -->
   <bean name="TranslatorDeploymentTemplateInfoFactory" class="org.teiid.templates.TranslatorTemplateInfoFactory"/>
           
</deployment>